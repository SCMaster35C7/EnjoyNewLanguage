<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="global.sesoc.Youtube.dao.EducationMapper">
	<select id="selectEduList" resultType="Education">
		select
			videonum
			, title
			, url
			, originalfile
			, savedfile
			, to_char(regdate, 'YYYY-MM-DD') regdate
			, hitcount
			, recommendation
			, decommendation
		from
			EducationVideo
		order by 
			regdate desc
	</select>
	
	<select id="selectOneFromEduVideo" parameterType="int" resultType="Education">
		select
			videonum
			, title
			, url
			, originalfile
			, savedfile
			, to_char(regdate, 'YYYY-MM-DD') regdate
			, hitcount
			, recommendation
			, decommendation
		from
			EducationVideo
		where
			videonum = #{videoNum}
	</select>
	
	<insert id="insertEduVideo" parameterType="Education">
		insert into EducationVideo(
			videonum
			, title
			, url
			, originalfile
			, savedfile
		)values (
			EDUCATION_VIDEO_SEQ.nextval
			, #{title}
			, #{url}
			, #{originalfile}
			, #{savedfile}
		)
	</insert>
	
	<select id="getTotalCount" parameterType="map" resultType="int">
		select
			count(*)
		from 
			EducationVideo
		where
			${searchType} like '%' || #{searchWord} || '%'
	</select>
	
	<update id="updateHitCount" parameterType="int">
		update
			EducationVideo
		set
			hitcount = hitcount+1
		where
			videonum = #{videonum}
	</update>
	
	<select id="selectOneFromRecommendation" parameterType="Recommendation" resultType="Recommendation">
		select
			*
		from
			recommendation
		where
			useremail = #{useremail}
		and
			identificationnum = #{identificationnum}
		and
			recommendtable = #{recommendtable}
	</select>
	
	<insert id="insertRecommendation" parameterType="Recommendation">
		insert into recommendation (
			useremail
			, identificationnum
			, recommendtable
			, recommendation
		)values (
			#{useremail}
			, #{identificationnum}
			, #{recommendtable}
			, #{recommendation}
		)
	</insert>
	
	<update id="updateIncreRecommend" parameterType="map">
		update
			EducationVideo
		set
			${commendation} = ${commendation}+1
		where
			videonum = #{videonum}
	</update>
	
	<delete id="deleteRecommend" parameterType="Recommendation">
		delete from
			recommendation
		where
			useremail = #{useremail}
		and
			identificationnum = #{identificationnum}
		and
			recommendtable = #{recommendtable}
	</delete>
	
	<update id="updateDecreRecommend" parameterType="map">
		update
			EducationVideo
		set
			${commendation} = ${commendation}-1
		where
			videonum = #{videonum}
	</update>
	
	<update id="updateRecommend" parameterType="Recommendation">
		update
			recommendation
		set
			recommendation = #{recommendation}
			, regdate = sysdate
		where
			useremail = #{useremail}
		and
			identificationnum = #{identificationnum}
		and
			recommendtable = #{recommendtable}
	</update>
</mapper>
